-- Fixed Throw Button - Works in Lobby & Game
if not _G.LobbyThrow then
    _G.LobbyThrow = true
    
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    
    -- Create button
    local gui = Instance.new("ScreenGui")
    gui.Name = "LobbyThrowGUI"
    gui.ResetOnSpawn = false
    
    local button = Instance.new("TextButton")
    button.Name = "ThrowBtn"
    button.Size = UDim2.new(0, 80, 0, 80)
    button.Position = UDim2.new(0.8, 0, 0.7, 0)
    button.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    button.BackgroundTransparency = 0.3
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = "THROW"
    button.TextScaled = true
    button.Font = Enum.Font.GothamBold
    button.BorderSizePixel = 0
    button.Visible = true  -- Always visible, but shows status
    
    -- Make it look nice
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.2, 0)
    corner.Parent = button
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 0, 0)
    stroke.Thickness = 2
    stroke.Parent = button
    
    button.Parent = gui
    gui.Parent = player:WaitForChild("PlayerGui")
    
    -- Throw function
    local function throwKnife()
        local character = player.Character
        if not character then 
            button.Text = "NO CHAR"
            return 
        end
        
        local backpack = player:FindFirstChild("Backpack")
        if not backpack then 
            button.Text = "NO BAG"
            return 
        end
        
        local knifeFound = false
        
        for _, tool in pairs(backpack:GetChildren()) do
            if tool:IsA("Tool") then
                local throwRemote = tool:FindFirstChild("Throw")
                if throwRemote then
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        local pos = humanoidRootPart.Position
                        local look = humanoidRootPart.CFrame.LookVector
                        local targetPos = pos + (look * 50)
                        
                        throwRemote:FireServer(
                            CFrame.new(pos, targetPos),
                            targetPos
                        )
                        print("âœ… Knife thrown!")
                        knifeFound = true
                        button.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
                        task.wait(0.3)
                        button.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
                    end
                end
            end
        end
        
        if not knifeFound then
            button.Text = "NO KNIFE"
            task.wait(1)
            button.Text = "THROW"
        end
    end
    
    button.MouseButton1Click:Connect(throwKnife)
    
    -- Update button status
    while true do
        task.wait(2)
        local backpack = player:FindFirstChild("Backpack")
        if backpack then
            local hasKnife = false
            for _, tool in pairs(backpack:GetChildren()) do
                if tool:IsA("Tool") and tool:FindFirstChild("Throw") then
                    hasKnife = true
                    break
                end
            end
            
            if hasKnife then
                button.Text = "THROW"
                button.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
            else
                button.Text = "LOBBY"
                button.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
            end
        end
    end
    
    print("ðŸŽ¯ Throw button loaded! Join a game to get knives!")
end
